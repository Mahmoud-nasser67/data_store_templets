{% extends 'partails/base.html' %}
{% load static %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}
{% block content %}
<div class="container my-5">
    <!-- Shop Details Section Begin -->
    <section class="shop-details">
        <div class="product__details__pic">
            <div class="container">
                <div class="row" style='    margin-bottom: 20;'>
                    <div class="col-lg-12">
                        <div class="product__details__breadcrumb">
                            <a href="{% url 'store.index' %}">{% trans 'Home' %}</a>
                            <a href="{% url 'store.shop' %}">{% trans 'Shop' %}</a>
                            <span>{% trans 'Product Details' %}</span>
                        </div>
                    </div>
                    <div style="position: relative;">
                            <a href="{% url 'toggle_favorite' product.slug %}" class="favorite-icon" style="
                                {% if LANGUAGE_CODE == "ar" %}
                                        position: absolute; top: 0px; left: 10px;
                                {% else %}
                                       position: absolute; top: 0px; right: 10px;
                                {% endif %} ">
                                {% if product.id in favorites %}
                                    <img src='/media/icon/heart_red.png'loading="lazy" alt="‚ù§Ô∏è" width="24" height="24">
                                {% else %}
                                    <img src='/media/icon/heart.png' loading="lazy" alt="ü§ç" width="24" height="24">
                                {% endif %}
                            </a>
                    </div>
                </div>
                
                
                <div class="row d-flex align-items-start gap-4">
                        <!-- ÿßŸÑÿµŸàÿ± -->
                        <div class="col-lg-4 col-md-6" style='    background-color: #ffffff59;'>
                            <div class="row">
                                <div class="col-lg-3 col-md-2">
                                    <ul class="nav nav-tabs" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" data-toggle="tab" href="#tabs-1" role="tab">
                                                <div class="product__thumb__pic set-bg" loading="lazy" style="background-image: url('{{ product.imge.url }}');"></div>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-toggle="tab" loading="lazy" href="#tabs-2" role="tab">
                                                <div class="product__thumb__pic set-bg"  loading="lazy" style="background-image: url('{{ product.imge2.url }}');"></div>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-toggle="tab" href="#tabs-3" role="tab">
                                                <div class="product__thumb__pic set-bg" loading="lazy" style="background-image: url('{{ product.imge3.url }}');"></div>
                                            </a>
                                        </li>
                                    </ul>
                                    
                                </div>
                                <div class="col-lg-9 col-md-10">
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="tabs-1" role="tabpanel">
                                            <div class="product__details__pic__item">
                                                <img src="{{ product.imge.url }}" loading="lazy" alt="">
                                            </div>
                                        </div>
                                        <div class="tab-pane" id="tabs-2" role="tabpanel">
                                            <div class="product__details__pic__item">
                                                <img src="{{ product.imge2.url }}" loading="lazy" alt="">
                                            </div>
                                        </div>
                                        <div class="tab-pane" id="tabs-3" role="tabpanel">
                                            <div class="product__details__pic__item">
                                                <img src="{{ product.imge3.url }}" loading="lazy" alt="">
                                            </div>
                                        </div>
                                    
                                    </div>
                                </div>
                            </div>
                        </div>
                    
                        <!-- ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ -->
                        <div class="col-lg-7 col-md-6">
                            <div class="product__details__text">
                                <h4>
                                    {% if LANGUAGE_CODE == "ar" %}
                                    {{ product.name }}
                                    {% else %}
                                    {{ product.translated_name }}
                                    {% endif %}
                                </h4>
                                <div class="rating">
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star-o"></i>
                                    <span> - 5 {% trans 'Reviews' %}</span>
                                </div>
                                <h3>${{ product.price }} <span>{{ product.spical_price }}$</span></h3>
                                <p>
                                    {% if LANGUAGE_CODE == "ar" %}
                                    {{ product.short_desc }}
                                    {% else %}
                                    {{ product.translated_short_desc }}
                                    {% endif %}
                                </p>
                                <div class="my-3">
                                    {% if product.excel_sample %}
                                    <a href="{{ product.excel_sample.url }}" download class="btn btn-success">
                                        <i class="lni lni-download"></i> {% trans 'Download Sample File' %}
                                    </a>
                                    {% else %}
                                    <p class="text-muted">{% trans 'No Excel sample available for this product.' %}</p>
                                    {% endif %}
                                </div>
                                <div class="product__details__cart__option">
                                    <div class="quantity">
                                        <div class="pro-qty">
                                            <input type="text" value="1">
                                        </div>
                                    </div>
                                    <a href="{% url 'store.cart_add' product.slug %}" class="primary-btn">{% trans 'add to cart' %}</a>
                                </div>
                               
                            </div>
                        </div>
                    </div>

            </div>
        </div>
        <div class="product__details__content">
            <div class="container">
                <div class="row d-flex justify-content-center">
                    <div class="col-lg-8">
                        <div class="product__details__text">
                             <button id="favorite-btn" data-product-id="{{ product.id }}" style='margin-bottom: 40px;'>
                                <a href="{% url 'toggle_favorite' product.slug %}" class="primary-btn">
                                    {% if product.id in favorites %}
                                        üíî ÿ•ÿ≤ÿßŸÑÿ© ŸÖŸÜ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©
                                    {% else %}
                                        ‚ù§Ô∏è ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©
                                    {% endif %}
                                </a>
                            </button>
                            <div class="product__details__btns__option">
                                <i class="fa fa-heart"> {% trans 'add to wishlist' %}</i>
                                <i class="fa fa-exchange"> {% trans 'Add To Compare' %}</i>
                            </div>
                            <div class="product__details__last__option">
                                <h5><span>{% trans 'Guaranteed Safe Checkout' %}</span></h5>
                                <img src="img/shop-details/details-payment.png" loading="lazy" alt="">
                                <ul>
                                    <li><span>{% trans 'SKU:' %}</span> 3812912</li>
                                    <li><span>{% trans 'Categories:' %}</span> {{ product.category }}</li>
                                    <li><span>{% trans 'This file has been ordered:' %}</span> {{ product.times_ordered }}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product__details__tab">
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" data-toggle="tab" href="#tabs-5"
                                       role="tab">{% trans 'Description' %}</a>
                                </li>
                                <li class="nav-item" style='margin-right: 100;'>
                                    <a class="nav-link" data-toggle="tab" href="#tabs-6" role="tab">{% trans 'Customer Previews' %}(5)</a>
                                </li>
                            
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="tabs-5" role="tabpanel">
                                    <div class="product__details__tab__content">
                                        <p class="note">{% trans 'Nam tempus turpis at metus scelerisque placerat nulla deumantos solicitud felis. Pellentesque diam dolor, elementum etos lobortis des mollis ut risus. Sedcus faucibus an sullamcorper mattis drostique des commodo pharetras loremos.' %}</p>
                                        <div class="product__details__tab__content__item">
                                            <h5>{% trans 'Products Information' %}</h5>

                                            <p> {% if LANGUAGE_CODE == "ar" %}
                                                {{ product.long_desc }}
                                                {% else %}
                                                {{ product.translated_long_desc }}
                                                {% endif%}</p>
                                        </div>

                                    </div>
                                </div>
                                <div class="tab-pane" id="tabs-6" role="tabpanel">
                                    <div class="product__details__tab__content">
                                        <div class="product__details__tab__content__item">

                                            <h5>{% trans 'Comments' %}</h5>
                                            {% for comment in comments %}
                                                <div class="comment mb-3 border rounded p-3 shadow-sm">
                                                    <div class="d-flex align-items-start">
                                                        <div class="me-3">
                                                            {% if comment.user.profile_image %}
                                                            <img src="{{ comment.user.profile_image.url }}" loading="lazy" alt="User Avatar"
                                                                 class="rounded-circle" width="40" height="40">
                                                                                                                        
                                                            {% else %}
                                                                <img src="{% static 'image/default-profile.jpg' %}" loading="lazy" class="rounded-circle" width="40" height="40" >
                                                            {% endif %}
                                                        </div>
                                                        <div>
                                                            <p class="fw-bold mb-1">{{ comment.user.username }} <span class="text-muted">üó®Ô∏è</span></p>
                                                            <p class="mb-2">{{ comment.content }}</p>
                                                            <hr class="my-2">
                                                        </div>
                                                    </div>
                                                </div>

                                            {% empty %}
                                            <p>{% trans 'No comments yet.' %}</p>
                                            {% endfor %}

                                            <!-- ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿπŸÑŸäŸÇ -->
                                            {% if user.is_authenticated %}
                                            <form method="post">
                                                {% csrf_token %}
                                                {{ form.as_p }}
                                                <button type="submit" style='    margin-top: 20;' class="btn btn-primary">{% trans 'Add Comment' %}
                                                </button>
                                            </form>
                                            {% else %}
                                            <p>{% trans 'You must' %} <a href="{% url 'login' %}">{% trans 'log in' %}</a> {% trans 'to leave a comment.' %}
                                            </p>
                                            {% endif %}

                                            <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ ÿ®ŸäŸÜ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ -->
                                            <div class="pagination mt-3">
                                                {% if comments.has_previous %}
                                                <a href="?page=1" class="btn btn-outline-secondary">{% trans 'First' %}</a>
                                                <a href="?page={{ comments.previous_page_number }}"
                                                   class="btn btn-outline-secondary">{% trans 'Previous' %}</a>
                                                {% endif %}
                                                <span class="mx-2">{% trans 'Page' %} {{ comments.number }} {% trans 'of' %} {{ comments.paginator.num_pages }}</span>
                                                {% if comments.has_next %}
                                                <a href="?page={{ comments.next_page_number }}"
                                                   class="btn btn-outline-secondary">{% trans 'Next' %}</a>
                                                <a href="?page={{ comments.paginator.num_pages }}"
                                                   class="btn btn-outline-secondary">{% trans 'Last' %}</a>
                                                {% endif %}
                                            </div>
                                        </div>

                                    </div>
                                    

                                </div>
                                <div class="tab-pane" id="tabs-7" role="tabpanel">
                                    <div class="product__details__tab__content">
                                        <p class="note">{% trans 'Nam tempus turpis at metus scelerisque placerat nulla deumantos solicitud felis. Pellentesque diam dolor, elementum etos lobortis des mollis ut risus. Sedcus faucibus an sullamcorper mattis drostique des commodo pharetras loremos.' %}</p>
                                        <div class="product__details__tab__content__item">
                                            <h5>{% trans 'Products Information' %}</h5>
                                            <p>{% trans 'A Pocket PC is a handheld computer, which features many of the same capabilities as a modern PC. These handy little devices allow individuals to retrieve and store e-mail messages, create a contact file, coordinate appointments, surf the internet, exchange text messages and more. Every product that is labeled as a Pocket PC must be accompanied with specific software to operate the unit and must feature a touchscreen and touchpad.' %}</p>
                                            <p>{% trans 'As is the case with any new technology product, the cost of a Pocket PC was substantial during it‚Äôs early release. For approximately $700.00, consumers could purchase one of top-of-the-line Pocket PCs in 2003. These days, customers are finding that prices have become much more reasonable now that the newness is wearing off. For approximately $350.00, a new Pocket PC can now be purchased.' %}</p>
                                        </div>
                                        <div class="product__details__tab__content__item">
                                            <h5>{% trans 'Material used' %}</h5>
                                            <p>{% trans 'Polyester is deemed lower quality due to its none natural quality‚Äôs. Made from synthetic materials, not natural like wool. Polyester suits become creased easily and are known for not being breathable. Polyester suits tend to have a shine to them compared to wool and cotton suits, this can make the suit look cheap. The texture of velvet is luxurious and breathable. Velvet is a great choice for dinner party jacket and can be worn all year round.' %}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
  
    
                                        
    <!-- Shop Details Section End -->
    <section class="related spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h3 class="related-title">{% trans 'Related Product' %}</h3>
                </div>
            </div>
            <div class="row">
                {% include 'common/Recommendations.html' with products=products %}
            </div>
        </div>
    </section>
<!-- ÿßŸÑÿ™ŸàÿµŸäÿßÿ™ / ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ∞ÿßÿ™ ÿßŸÑÿµŸÑÿ© -->

</div>
<script>
    document.getElementById("favorite-btn").addEventListener("click", function() {
        var productId = this.getAttribute("data-product-id");
        fetch(`/toggle-favorite/${productId}/`, {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/json"
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "added") {
                this.innerHTML = "üíî ÿ•ÿ≤ÿßŸÑÿ© ŸÖŸÜ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©";
            } else {
                this.innerHTML = "‚ù§Ô∏è ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©";
            }
        });
    });
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function(){
        $("#comment-form").submit(function(e){
            e.preventDefault();  // ŸÖŸÜÿπ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä

            $.ajax({
                type: "POST",
                url: window.location.href,
                data: $(this).serialize(),
                headers: {
                    "X-Requested-With": "XMLHttpRequest"
                },
                success: function(response) {
                    if (response.error) {
                        alert(response.error);
                    } else {
                        $("#comments-section").prepend(`
                            <div class="comment mb-3 border rounded p-3 shadow-sm">
                                <div class="d-flex align-items-start">
                                    <div class="me-3">
                                        <img src="${response.profile_image}" alt="User Avatar" class="rounded-circle" width="40" height="40">
                                    </div>
                                    <div>
                                        <p class="fw-bold mb-1">${response.username} <span class="text-muted">üó®Ô∏è</span></p>
                                        <p class="mb-2">${response.content}</p>
                                        <hr class="my-2">
                                    </div>
                                </div>
                            </div>
                        `);
                        $("#comment-form")[0].reset();  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÅŸàÿ±ŸÖ
                    }
                },
                error: function() {
                    alert("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ÿπŸÑŸäŸÇ.");
                }
            });
        });
    });
</script>
{% endblock %}